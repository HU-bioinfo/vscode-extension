# VS Code 拡張機能開発ガイドライン

## 開発環境

- コマンド実行時に問題が発生した場合は、コンソールをリセットし、カレントディレクトリを確認してから個別にコマンドを実行する

## 開発の基本原則

- 単一責任の原則に従う
- ユーザー作業を妨げない設計
- パフォーマンスとリソース消費の最適化
- VS Code API を最大限活用
- 仕様駆動開発とテスト駆動開発のハイブリッドアプローチ:
  - docs に仕様・修正プランを記述し、テストを作成
  - テスト失敗を確認してから実装
  - 仕様変更が必要な場合は先に docs を更新

## 拡張機能の構成

1. **アクティベーション**: 必要最小限のイベントを使用
2. **コマンド**: 命名規則 `拡張機能名.アクション` に従う
3. **設定項目**: 必要最小限に抑える
4. **WebviewAPI**: 必要な場合のみ使用し、軽量に保つ

## コーディングガイドライン

- コマンド登録は集中管理する
- ビジネスロジックと VS Code API 呼び出しを分離
- Disposable パターンを適切に実装
- 設定値アクセスはユーティリティ経由で行う

## UI 設計

- VS Code のデザイン言語に準拠
- アクセシビリティに配慮
- i18n 対応（英語・日本語を基本）
- レスポンシブな UI 設計

## パフォーマンス最適化

- 重い処理はメインスレッド外で実行
- 遅延ロードとキャッシングを実装
- バックグラウンド処理はキャンセル可能に

## テスト戦略

- **単体テスト**: モジュール単位
- **E2E テスト**: ユーザーシナリオ全体
- **モック戦略**:
  - VS Code API: Sinon、テスト環境変数で制御
  - 外部依存: child_process.exec などをモック
- **カバレッジ目標**: 関数 90%・行 80%・分岐 75%以上

## エラー処理

- すべてのエラーを適切にキャッチし通知
- エラーレベルを適切に設定
- ユーザーに具体的な回復アクションを提案

## セキュリティ

- 最小権限の原則に従う
- 機密情報は暗号化して保存
- WebView 使用時は CSP を適切に設定

## Git バージョン管理

- **ブランチ戦略**: GitFlow に準拠（main, develop, feature/_, hotfix/_）
- **コミット規約**: Conventional Commits 形式（feat:, fix:, docs:など）
- **バージョン管理**: SemVer 準拠、タグ付けと CHANGELOG 更新
- **CI/CD**: PR でテスト自動実行、リリースで自動公開

## ディレクトリ構造

```
{拡張機能名}/
├── src/               # ソースコード
├── resources/         # 静的リソース
├── package.json       # マニフェスト
├── CHANGELOG.md       # 変更履歴
└── README.md          # 説明
```

## デバッグ

- OutputChannel を使用したログ出力
- 開発時は詳細ログ、本番は最小限
- デバッグ情報表示機能の実装

## 互換性

- 最小サポート VSCode バージョンを明確化
- 複数 OS 対応の確認
- リモート開発環境での動作確認
