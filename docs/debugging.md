# VS Code拡張機能のデバッグ方法

このドキュメントでは、VS Code拡張機能のデバッグ方法について説明します。特に、クリーンな環境での動作確認と、依存拡張機能を含む環境でのデバッグについて詳しく説明します。

## デバッグ設定の概要

プロジェクトには2つのデバッグ設定が含まれています：

1. **クリーン環境で実行**: 他の拡張機能を一切ロードせずに本拡張機能のみをテストします
2. **依存拡張機能ありで実行**: 特定の依存拡張機能がインストールされた状態でテストします

## クリーン環境でのデバッグ

クリーン環境でのデバッグは、拡張機能が他の拡張機能に依存せずに正しく動作することを確認するために重要です。

### 手順

1. VS Codeの「実行とデバッグ」パネルを開きます
2. ドロップダウンから「クリーン環境で実行」を選択します
3. 実行ボタン (F5) を押します

この設定は、`--disable-extensions`フラグを使用して他のすべての拡張機能を無効化し、拡張機能開発ホスト内で本拡張機能のみを実行します。

## 依存拡張機能を含む環境でのデバッグ

本拡張機能は特定の拡張機能に依存しています。この設定では、必要な依存拡張機能がインストールされた状態で拡張機能をテストします。

### 手順

1. VS Codeの「実行とデバッグ」パネルを開きます
2. ドロップダウンから「依存拡張機能ありで実行」を選択します
3. 実行ボタン (F5) を押します

初回実行時、または依存関係が変更された場合は、必要な拡張機能がインストールされるまで少し時間がかかることがあります。

### 依存拡張機能の設定

依存拡張機能は `scripts/install-dependencies.js` ファイルで管理されています。依存関係を追加または変更するには、このファイルの `dependencies` 配列を編集してください：

```javascript
const config = {
  extensionsDir: path.join(__dirname, '..', '.vscode-test', 'extensions'),
  dependencies: [
    // 依存するエクステンションのIDを指定
    "ms-vscode-remote.remote-containers",
    "ms-vscode-remote.remote-wsl"
    // 他の依存拡張機能をここに追加
  ]
};
```

現在、以下の依存拡張機能がインストールされます：

- **Remote - Containers**: コンテナ内での開発をサポート
- **Remote - WSL**: Windows Subsystem for Linux での開発をサポート

### 注意事項

依存拡張機能は通常のVS Codeにインストールされます。初めは分離された環境にインストールする設定でしたが、一部の環境では`--extensions-dir`オプションがサポートされていないため、通常のVS Codeの拡張機能として依存拡張機能をインストールするように変更されました。

このため、依存拡張機能は開発セッション中だけでなく、通常のVS Codeセッションでも利用可能です。必要に応じて、使用後に手動で拡張機能を削除することができます。

## トラブルシューティング

### 依存拡張機能のインストールエラー

依存拡張機能のインストールに失敗した場合：

1. ターミナルで `node scripts/install-dependencies.js` を実行して、エラーメッセージを確認します
2. VS Codeへのアクセス権が正しく設定されていることを確認します
3. インターネット接続を確認します

### デバッグセッションの開始エラー

デバッグセッションの開始に問題がある場合：

1. プロジェクトが正しくビルドされていることを確認します (`npm run compile`)
2. VS Codeを再起動してみてください
3. 依存拡張機能が正しくインストールされていることを確認します

## 高度なデバッグ技法

### ブレークポイントの設定

TypeScriptソースコードにブレークポイントを設定することで、実行時の状態を検査できます：

1. ソースファイル内でブレークポイントを設定したい行をクリックします
2. F9を押すか、行番号の左側をクリックしてブレークポイントを設定します

### ログの確認

デバッグコンソールには、拡張機能の実行時に出力されるログメッセージが表示されます。
また、「出力」パネルで「開発ホスト」を選択すると、より詳細なログを確認できます。 